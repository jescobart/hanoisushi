import{c as b}from"./createLucideIcon-gj9TAl09.js";import{j as e,r as x}from"./jsx-runtime-BGxL3LVy.js";import{B as I}from"./index-cWEE_j1p.js";import{a as R,b as D,u as j}from"./useWebsite-B2NA3eOh.js";import{c as y}from"./utils-mMyIM9tf.js";import{a as u,g as _}from"./index-DUyAALTD.js";import{S as C}from"./index-B7S20zKg.js";import{L as E}from"./index-BJLV6hUK.js";import{a as L,b as T,s as $}from"./index-BHERncwe.js";import{X as z,W as B,z as w,B as O}from"./apollo-hooks.es-DZ97-Of4.js";import{g as U,c as v,u as W}from"./index-Dg1ijqza.js";import{J as F}from"./index-DR85t-yO.js";import{u as Q}from"./loginViaAuth-CQHEdACz.js";import{B as V}from"./button-B9Ixe4GG.js";import{D as G,a as H,b as J,f as X}from"./dropdown-menu-YfhecZr1.js";import{g as M}from"./gql-CqV_3job.js";import{i as Y,j as K}from"./env-D6s-xqZ4.js";import{g as Z}from"./Context-BxTGfssI.js";import{u as ee,g as ae}from"./index-u35E67kG.js";import{u as P}from"./useTranslation-B_PywvDf.js";import{L as ne}from"./components-C7TJjWXG.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=b("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=b("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=b("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=b("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=b("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),de={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"getServerExperimentBranch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"experimentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"websiteId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"countryCode"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getUserExperimentBranch"},arguments:[{kind:"Argument",name:{kind:"Name",value:"experimentId"},value:{kind:"Variable",name:{kind:"Name",value:"experimentId"}}},{kind:"Argument",name:{kind:"Name",value:"websiteId"},value:{kind:"Variable",name:{kind:"Name",value:"websiteId"}}},{kind:"Argument",name:{kind:"Name",value:"countryCode"},value:{kind:"Variable",name:{kind:"Name",value:"countryCode"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"branchName"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}}]}}]}}]},oe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"getUserExperimentBranch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"experimentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deviceId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"websiteId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"countryCode"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getUserExperimentBranch"},arguments:[{kind:"Argument",name:{kind:"Name",value:"experimentId"},value:{kind:"Variable",name:{kind:"Name",value:"experimentId"}}},{kind:"Argument",name:{kind:"Name",value:"websiteId"},value:{kind:"Variable",name:{kind:"Name",value:"websiteId"}}},{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"deviceId"},value:{kind:"Variable",name:{kind:"Name",value:"deviceId"}}},{kind:"Argument",name:{kind:"Name",value:"countryCode"},value:{kind:"Variable",name:{kind:"Name",value:"countryCode"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"branchName"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}}]}}]}}]},ce={"query getServerExperimentBranch(\n        $experimentId: String!\n        $websiteId: String\n        $countryCode: String\n      ) {\n        getUserExperimentBranch(\n          experimentId: $experimentId\n          websiteId: $websiteId\n          countryCode: $countryCode\n        ) {\n          branchName\n          createdAt\n        }\n      }":de,"query getUserExperimentBranch(\n      $experimentId: String!\n      $deviceId: String\n      $websiteId: String\n      $userId: String\n      $countryCode: String\n    ) {\n      getUserExperimentBranch(\n        experimentId: $experimentId\n        websiteId: $websiteId\n        userId: $userId\n        deviceId: $deviceId\n        countryCode: $countryCode\n      ) {\n        branchName\n        createdAt\n      }\n    }":oe};function le(a){return ce[a]}function me(a){var o;if(Y)return null;const n=R(),r=D(),d=Z(),{userId:i}=U(),{data:s}=z({clientName:v.experiments,query:le(`query getUserExperimentBranch(
      $experimentId: String!
      $deviceId: String
      $websiteId: String
      $userId: String
      $countryCode: String
    ) {
      getUserExperimentBranch(
        experimentId: $experimentId
        websiteId: $websiteId
        userId: $userId
        deviceId: $deviceId
        countryCode: $countryCode
      ) {
        branchName
        createdAt
      }
    }`),variables:{experimentId:a,websiteId:n,userId:i,deviceId:d,countryCode:r},fetchPolicy:"cache-first"});return(o=s==null?void 0:s.getUserExperimentBranch)==null?void 0:o.branchName}function ue(a){const n=e.jsx("div",{className:y("flex-1 flex items-center justify-center",a.className),children:e.jsx(E,{message:a.message})});return e.jsx(x.Suspense,{fallback:n,children:a.children})}function pe(){var i;const a=(i=j())==null?void 0:i._id,n=u(s=>{var o;return(o=s.preferences)==null?void 0:o.placeId}),{data:r,loading:d}=B({clientName:v.preferences,query:_(`
      query getAvailableStores($placeId: String!, $websiteId: String!) {
        availableStores(placeId: $placeId, websiteId: $websiteId) {
          _id
          name
          address {
            address
          }          
        }
      }
    `),variables:{placeId:n,websiteId:a},skip:!n||!a});return{data:(r==null?void 0:r.availableStores)||[],loading:d}}function fe(){var d;const a=w(),n=(d=j())==null?void 0:d._id,r=u(i=>{var s;return(s=i.preferences)==null?void 0:s.placeId});return async i=>{try{await a({clientName:v.preferences,mutation:_(`
          mutation SetPreferredDeliveryStore($storeId: String, $websiteId: String, $placeId: String) {
            setPreferredDeliveryStore(storeId: $storeId, websiteId: $websiteId, placeId: $placeId)
          }
        `),variables:{storeId:i,websiteId:n,placeId:r},refetchQueries:["getOrderPreferences"]})}catch(s){throw L(s),s}}}function he(){const a=w(),n=u(d=>d.preferences),r=u(d=>d.setAddress);return async d=>{var i;try{((i=n.address)==null?void 0:i.placeId)===d.placeId&&r(null),await a({clientName:v.main,mutation:M(`mutation deleteAddress($addressId: ID!) {
          deleteAddress(addressId: $addressId)
        }`),variables:{addressId:d._id},refetchQueries:["getUserAddresses"],awaitRefetchQueries:!0}),T("Se ha eliminado tu dirección correctamente")}catch(s){L(s)}}}function xe(a){var f;const{address:n,onSelect:r}=a,d=he(),i=u(m=>m.preferences),s=u(m=>m.setAddress),o=u(m=>m.setChoosePlaceOpen);return e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx(V,{variant:((f=i.address)==null?void 0:f._id)===n._id?"default":"secondary",className:"text-left h-auto flex-1 overflow-hidden flex-col items-start",onClick:()=>{s(n),o(!1),r()},children:e.jsxs("div",{className:"",children:[e.jsx("div",{className:y("font-bold",{}),children:n.streetAddress}),n.extendedAddress&&e.jsx("div",{children:n.extendedAddress}),e.jsxs("div",{children:[n.locality,", ",n.countryName]})]})}),e.jsxs(G,{children:[e.jsx(H,{asChild:!0,children:e.jsx(V,{variant:"ghost",className:"h-auto",children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsx(J,{className:"w-56",children:e.jsx(X,{onClick:()=>d(n),children:"Eliminar dirección"})})]})]},n._id)}function ve(){const{data:a}=B({clientName:v.main,query:M(`query getUserAddresses {
      addresses {
        _id
        streetAddress
        extendedAddress
        locality
        countryName
        placeId
      }
    }`)});return a.addresses||[]}function ge(a){const n=ve(),{userId:r}=U(),d=Q(),i=W();return e.jsxs("div",{className:"space-y-2",children:[n.map(s=>e.jsx(xe,{address:s,onSelect:a.onSelect},s._id)),!r&&i.showLoginButton&&e.jsxs("div",{className:"text-sm text-center",children:["¿Ya tienes una cuenta"," ",e.jsx(F,{className:"inline-flex top-0.5 ml-1 relative",height:14}),"?"," ",e.jsx(I,{variant:"link",size:"auto",onClick:d,children:"Inicia sesión con ella"})]})]})}const ke={local:"http://components.internal:5140",dev:"https://components.bejusto.com",prod:"https://components.getjusto.com"}[K]||"https://components.getjusto.com";function Ne({onAbort:a,onConfirm:n,onStep:r}){var S;const d=D(),[i,s]=x.useState(!0),{designConfiguration:o}=j(),f=ee({}),m=x.useRef(null),g=me("address-provider-aws-or-google"),l=new URLSearchParams({appIdentifier:"websites",provider:g||"google",countryCode:d,darkMode:o.isDark?"true":"false",backgroundColor:f.plainBackgroundColor.replace("#",""),primaryColor:(S=o==null?void 0:o.primaryColor)==null?void 0:S.replace("#","")}),k=`${ke}/address-form?${l.toString()}`;return x.useEffect(()=>{const h=c=>{console.log("Received message from iframe"),c.data.type==="resize"&&(console.log("Received resize message from iframe",c.data.height),m.current.style.height=`${c.data.height}px`),c.data.type==="success"&&(console.log("Received success message from iframe",c.data.address),n(c.data.address)),c.data.type==="failed"&&(console.log("Received failed message from iframe",c.data.error),a(c.data.error)),c.data.type==="step"&&(console.log("Received step message from iframe",c.data.step),r(c.data.step)),c.data.type==="loaded"&&(console.log("Received loaded message from iframe"),s(!1))};return window.addEventListener("message",h),()=>window.removeEventListener("message",h)},[]),e.jsxs("div",{className:"relative",children:[i?e.jsx("div",{className:"absolute top-0 w-full h-full flex flex-row items-center justify-center bg-plain dark:bg-zinc-800",children:e.jsx(E,{})}):null,e.jsx("iframe",{ref:m,title:"V3 Address Form",className:"w-full flex items-center justify-center",src:k,allow:"geolocation",sandbox:"allow-scripts allow-same-origin"})]})}function ye(){const a=w(),n=O({clientName:v.main});return async r=>{await a({mutation:ae`
        mutation claimAddress($addressRefString: String!) {
          claimAddress(addressRefString: $addressRefString) {
            id
            provider
          }
        }
      `,variables:{addressRefString:r},clientName:v.addresses}),await n("getUserAddresses")}}function be({setShowSelectPlace:a,showOnlyStores:n}){const{t:r}=P(),[d,i]=x.useState("choose"),[s,o]=x.useState(null),f=ye(),m=u(t=>t.setAddress),g=u(t=>t.setChoosePlaceOpen),{data:l,loading:k}=pe(),S=fe(),h=u(t=>{var p;return(p=t.preferences)==null?void 0:p.address}),c=u(t=>{var p;return(p=t.preferences)==null?void 0:p.store}),q=async t=>{try{o(t),await S(t),a(!1)}catch(p){console.error("Error setting preferred store",p)}finally{o(null)}},A=()=>k?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx(C,{className:"w-8 h-8"})}):l!=null&&l.length?l.map(t=>{const p=t._id===(c==null?void 0:c._id),N=s===t._id;return e.jsxs("button",{type:"button",disabled:N,onClick:()=>q(t._id),className:y("w-full text-left p-4 rounded-lg border hover:bg-muted transition-colors","flex items-center space-x-3",p&&"border-primary bg-primary/5",N&&"opacity-50 cursor-wait"),children:[e.jsx(re,{className:y("w-5 h-5",p?"text-primary":"text-muted-foreground")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.address.address})]}),N?e.jsx(C,{className:"w-5 h-5 text-primary"}):p&&e.jsx(te,{className:"w-5 h-5 text-primary flex-shrink-0"})]},t._id)}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay locales disponibles en esta zona"});return n&&(h!=null&&h._id)?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{variant:"ghost",size:"icon",onClick:()=>a(!1),children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("div",{className:"text-sm font-medium",children:r("Selecciona un local")})]}),A()]}):e.jsxs("div",{className:"space-y-5",children:[["choose","search"].includes(d)?e.jsx(e.Fragment,{children:e.jsx(ue,{children:e.jsx(ge,{onSelect:()=>{a(!1)}})})}):null,e.jsx("div",{className:"-mx-5",children:e.jsx(Ne,{onAbort:t=>{t&&($({variant:"destructive",title:"Error al guardar tu dirección",description:t.message}),console.error("ViteAddressIFrame abort with error",t)),i("create")},onConfirm:t=>{if(t){const{placeId:p}=t;f(p).then(()=>{i("choose"),m(t),g(!1),a(!1)}).catch(N=>{$({variant:"destructive",title:"Error al guardar tu dirección",description:N.message}),console.error("Error claimAddress",N)})}},onStep:i})}),(h==null?void 0:h._id)&&(l==null?void 0:l.length)>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:r("Selecciona un local")}),A()]})]})}function Fe(){const{t:a}=P(),[n,r]=x.useState(!1),[d,i]=x.useState(!1),s=u(l=>{var k;return(k=l.preferences)==null?void 0:k.address}),o=u(l=>!!l.preferences),f=u(l=>l.preferences.store),m=j(),g=m==null?void 0:m.showStoreName;return o?!(s!=null&&s._id)||n?e.jsx(be,{setShowSelectPlace:r,showOnlyStores:d}):e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:a("awful_civil_rat_seek")}),e.jsxs("div",{className:"flex space-x-2 max-w-full overflow-hidden",children:[e.jsx("div",{className:"text-left h-auto flex-1 overflow-hidden text-sm bg-muted p-2 rounded-md",children:e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("div",{className:"font-bold truncate",children:s.streetAddress}),s.extendedAddress&&e.jsx("div",{className:"truncate",children:s.extendedAddress}),e.jsxs("div",{children:[s.locality,", ",s.countryName]})]})}),e.jsx(I,{className:"h-auto",variant:"outline",onClick:()=>{i(!1),r(!0)},children:a("vivid_grassy_flea_pop")})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-1 mt-1 flex items-center gap-2",children:g&&f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Estás pidiendo a"}),e.jsx("span",{className:"font-bold",children:f.name})]}),e.jsx(I,{variant:"link",size:"auto",className:y("text-primary hover:text-primary/80 transition-colors p-0 h-auto","flex items-center gap-1 font-medium"),onClick:()=>{i(!0),r(!0)},children:a("vivid_grassy_flea_pop")})]})})]}):null}function Qe(a){const n=a.to??a.href;return n?n.startsWith("/")&&!n.includes("//")&&!a.openInNewWindow?e.jsx(ne,{to:n,className:a.className,children:a.children}):e.jsx("a",{href:n,target:a.openInNewWindow===!1?null:"_blank",rel:"noopener noreferrer",className:a.className,children:a.children}):e.jsx("span",{className:a.className,children:a.children})}export{Fe as C,We as P,ue as S,Qe as a,re as b,me as u};
