import{a as k,c as s,d as p}from"./useWebsite-B2NA3eOh.js";import{j as m}from"./env-D6s-xqZ4.js";import{u as g}from"./useScript-DIQuGbCK.js";import{z as c}from"./apollo-hooks.es-DZ97-Of4.js";import{a as v}from"./index-BHERncwe.js";import{c as u,s as b}from"./index-Dg1ijqza.js";import{u as x}from"./useOnCreateSession.main-8_To5xw3.js";import{g as I}from"./gql-CqV_3job.js";const N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"createOrloginExternalProvider"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"externalId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"extraData"}},type:{kind:"NamedType",name:{kind:"Name",value:"JSON"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"provider"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createOrLoginWithExternalProvider"},arguments:[{kind:"Argument",name:{kind:"Name",value:"externalId"},value:{kind:"Variable",name:{kind:"Name",value:"externalId"}}},{kind:"Argument",name:{kind:"Name",value:"extraData"},value:{kind:"Variable",name:{kind:"Name",value:"extraData"}}},{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"Variable",name:{kind:"Name",value:"provider"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"token"}},{kind:"Field",name:{kind:"Name",value:"refreshToken"}},{kind:"Field",name:{kind:"Name",value:"userId"}}]}}]}}]},w={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"loginWithExternalProvider"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"externalId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"provider"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"loginWithAnExternalProvider"},arguments:[{kind:"Argument",name:{kind:"Name",value:"externalId"},value:{kind:"Variable",name:{kind:"Name",value:"externalId"}}},{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"Variable",name:{kind:"Name",value:"provider"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"refreshToken"}},{kind:"Field",name:{kind:"Name",value:"token"}},{kind:"Field",name:{kind:"Name",value:"userId"}}]}}]}}]},f={"mutation createOrloginExternalProvider(\n          $externalId: String\n          $extraData: JSON\n          $provider: String\n        ) {\n          createOrLoginWithExternalProvider(\n            externalId: $externalId\n            extraData: $extraData\n            provider: $provider\n          ) {\n            token\n            refreshToken\n            userId\n          }\n        }":N,"mutation loginWithExternalProvider (\n          $externalId: String\n          $provider: String\n        ) {\n          loginWithAnExternalProvider (\n            externalId: $externalId, \n            provider: $provider\n          ) {\n            refreshToken\n            token\n            userId\n          }\n        }":w};function S(a){return f[a]??{}}function h(){const a=c(),r=k();return async o=>{try{await a({clientName:u.main,mutation:I(`mutation signTermsAutomatically($userId: String, $websiteId: String) {
          signTermsAutomatically(userId: $userId, websiteId: $websiteId)
        }`),variables:{websiteId:r,userId:o}})}catch(d){v(d)}}}function y(){const a=c(),r=x(),o=h(),d=s(),i=p();return async t=>{try{const n=await a({clientName:u.auth,mutation:S(`mutation createOrloginExternalProvider(
          $externalId: String
          $extraData: JSON
          $provider: String
        ) {
          createOrLoginWithExternalProvider(
            externalId: $externalId
            extraData: $extraData
            provider: $provider
          ) {
            token
            refreshToken
            userId
          }
        }`),variables:t}),e=n.createOrLoginWithExternalProvider.userId;await o(e),await r(e),b(n.createOrLoginWithExternalProvider.token,n.createOrLoginWithExternalProvider.refreshToken)}catch{v("No pudimos validar tu cuenta en este momento, por favor reinténtalo más tarde"),setTimeout(()=>{window.location.replace(`/pedir?webview=${d}&externalParams=${i}`)},2e3)}}}const D={local:"https://yape3-static.stg.yape.tech/libs/dist/lib-node-webview-bridge@v1.0.1-rc.0/index.js",dev:"https://yape3-static.stg.yape.tech/libs/dist/lib-node-webview-bridge@v1.0.1-rc.0/index.js",prod:"https://yape3-static.yape.tech/libs/dist/lib-node-webview-bridge@v1.0.1/index.js"}[m],l={local:"PIN008",dev:"PIN008",prod:"PIN008"}[m];function A(){const a=y(),r=s(),o=async i=>{const t=window.YapeWebViewInterface;console.log("YapeWebViewInterfaceCreate: Sending getSensitiveDataConsent",{yapeAccountId:i,partnerCode:l,version:1}),t.emit("getSensitiveDataConsent",{yapeAccountId:i,partnerCode:l,version:1}),t.on("setSensitiveDataConsent",async n=>{const e=JSON.parse(n);console.log("YapeWebViewInterfaceCreate: Received setSensitiveDataConsent",e),await a({externalId:i,extraData:{version:"1",id:e==null?void 0:e.sensitiveDataConsentId,partnerCode:l},provider:r}),console.log("YapeWebViewInterfaceCreate: finished login process")})},d=async()=>{window.YapeWebViewInterface.on("yapeAccountIdReceived",t=>{const n=JSON.parse(t);console.log("YapeWebViewInterfaceCreate: Received yapeAccountIdReceived",n);const{yapeAccountId:e}=n;o(e)}),console.log("YapeWebViewInterfaceCreate: Sending requestYapeAccountId"),window.YapeWebViewInterface.emit("requestYapeAccountId",{})};return g(`${D}?mode=createOrLogin`,()=>{console.log("YapeWebViewInterfaceCreate: Yape createOrLogin lib loaded"),d()}),null}export{A as C,y as c,S as g,D as s,h as u};
