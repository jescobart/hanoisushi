import{r as y,j as e}from"./jsx-runtime-BGxL3LVy.js";import{B as $}from"./index-cWEE_j1p.js";import{O as k}from"./index-C7wa7IgK.js";import{C as b}from"./ClientOnly-C9d8okrb.js";import{a as P,c as f,d as N,u as g}from"./useWebsite-B2NA3eOh.js";import{u as I}from"./isJustoApp-DujzpsFs.js";import{c as C}from"./utils-mMyIM9tf.js";import{r as O,c as q,s as R,u as M,g as w}from"./index-Dg1ijqza.js";import{u as z}from"./loginViaAuth-CQHEdACz.js";import{B as v}from"./button-B9Ixe4GG.js";import{D,a as _,b as U,d as B,e as m,f as l}from"./dropdown-menu-YfhecZr1.js";import{z as S}from"./apollo-hooks.es-DZ97-Of4.js";import{g as T}from"./gql-CqV_3job.js";import{a as V}from"./index-DUyAALTD.js";import{S as Y}from"./index-B7S20zKg.js";import{a as H}from"./index-BHERncwe.js";import{u as J,g as F,s as Z}from"./index-D0qyXq4U.js";import{u as K}from"./useOnCreateSession.main-8_To5xw3.js";import{u as G}from"./useScript-DIQuGbCK.js";import{c}from"./createLucideIcon-gj9TAl09.js";import{L as j}from"./components-C7TJjWXG.js";import{S as Q}from"./shopping-bag-DGgdUTTN.js";import{a as A,u as L}from"./index-CXeFjl5i.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=c("AppWindow",[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}],["path",{d:"M10 4v4",key:"pp8u80"}],["path",{d:"M2 8h20",key:"d11cs7"}],["path",{d:"M6 4v4",key:"1svtjw"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=c("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=c("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=c("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=c("Cog",[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=c("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=c("Rss",[["path",{d:"M4 11a9 9 0 0 1 9 9",key:"pv89mb"}],["path",{d:"M4 4a16 16 0 0 1 16 16",key:"k0647b"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=c("SquareArrowOutUpRight",[["path",{d:"M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6",key:"y09zxi"}],["path",{d:"m21 3-9 9",key:"mpx6sq"}],["path",{d:"M15 3h6v6",key:"1q9fwt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=c("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),ie="19786968728",ce=t=>{var d;const{type:n,whatsAppSupportNumber:r,code:s,sendEventMessageSupport:o}=t,i={"mi orden":"número ","mi reserva":"código #","":"..."}[n]||"",u=`Hola. Necesito ayuda con ${n} ${i}${s??""}`,p=`https://wa.me/${r||ie}?text=${encodeURIComponent(u)}`;if(o){const x={type:"open_chat_support",redirectUrl:p};return console.log("eventMessage",x),(d=window.ReactNativeWebView)==null||d.postMessage(JSON.stringify(x)),null}return window.open(p),null};function le(){const t=S(),n=P(),r=O();return async()=>{await t({mutation:T(`
        mutation clonePreferencesOnLogout($websiteId: ID!) {
          clonePreferencesOnLogout(websiteId: $websiteId) {
            _id
          }
        }
      `),variables:{websiteId:n}}),r()}}function E(){const t=S(),n=K(),r=J();return async s=>{try{console.log("useLoginWithExternalProvider: loginWithExternalProvider");const a=(await t({clientName:q.auth,mutation:F(`mutation loginWithExternalProvider (
          $externalId: String
          $provider: String
        ) {
          loginWithAnExternalProvider (
            externalId: $externalId, 
            provider: $provider
          ) {
            refreshToken
            token
            userId
          }
        }`),variables:s})).loginWithAnExternalProvider,i=a==null?void 0:a.userId;if(!i)return;await r(i),await n(i),R(a==null?void 0:a.token,a==null?void 0:a.refreshToken)}catch(o){H(o)}}}function de(){const t=E(),n=f(),r=N(),s=y.useRef(!1);return y.useEffect(()=>{r&&!s.current&&(console.log("DaleCO: params send to login",{externalId:r,provider:n}),s.current=!0,t({externalId:r,provider:n}))},[r]),!r||s.current?null:e.jsx("div",{"aria-live":"polite",children:e.jsx(Y,{size:"xs"})})}function pe(){const t=f(),n=E();return G(`${Z}?mode=login`,()=>{console.log("YapeWebViewInterfaceAutoLogin: Yape login mode lib loaded");const r=window.YapeWebViewInterface;r.on("yapeAccountIdReceived",s=>{const o=JSON.parse(s);console.log("YapeWebViewInterfaceAutoLogin: Received yapeAccountIdReceived",o),n({externalId:o==null?void 0:o.yapeAccountId,provider:t})}),console.log("YapeWebViewInterfaceAutoLogin: Sending requestYapeAccountId"),r.emit("requestYapeAccountId",{})}),null}function ue(){const t=M();return e.jsxs(b,{children:[t.loginWithExternalProvider==="yape"&&e.jsx(pe,{}),t.loginWithExternalProvider==="daleCo"&&e.jsx(de,{})]})}function he(){var h,p;const t=w(),n=le(),r=z(),s=M(),o=g(),a=V(d=>d==null?void 0:d.me),{roles:i}=w(),u=(i==null?void 0:i.length)||((h=a==null?void 0:a.roleInWebsite)==null?void 0:h._id);return t.userId?e.jsxs(D,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(v,{variant:"opacity",size:"icon",className:"rounded-full",children:[e.jsx(se,{className:"h-6 w-6"}),e.jsx("span",{className:"sr-only",children:"Abrir menú de usuario"})]})}),e.jsxs(U,{align:"end",children:[e.jsxs(B,{children:[e.jsx("div",{children:t.fullName}),!s.hideEmailAddress&&e.jsx("div",{className:"font-normal text-muted-foreground",children:t.email})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx(m,{}),e.jsx(l,{asChild:!0,children:e.jsxs("a",{href:`https://admin.getjusto.com/${o._id}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Admin"]})}),e.jsx(l,{asChild:!0,children:e.jsxs("a",{href:`https://hub.getjusto.com/${o._id}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Hub"]})}),e.jsx(l,{asChild:!0,children:e.jsxs("a",{href:"https://pos.getjusto.com",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Punto de ventas"]})})]}),e.jsx(m,{}),((p=o==null?void 0:o.loyaltyProgramConfig)==null?void 0:p.active)&&e.jsx(l,{asChild:!0,children:e.jsxs(j,{to:"/justoloyalty",prefetch:"intent",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),o.loyaltyProgramConfig.name]})}),e.jsx(l,{asChild:!0,children:e.jsxs(j,{to:"/pedidos",prefetch:"intent",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Mis compras"]})}),s.showMessageSupport&&e.jsx(l,{asChild:!0,children:e.jsxs("div",{onClick:()=>ce({type:"mi cuenta",whatsAppSupportNumber:s.whatsAppSupportNumber,sendEventMessageSupport:s.sendEventMessageSupport}),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Soporte"]})}),s.showLogout&&e.jsx(l,{asChild:!0,children:e.jsxs("a",{href:"https://accounts.getjusto.com/settings/profile",target:"_blank",rel:"noreferrer",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Mi cuenta"]})}),s.showLogout&&e.jsxs(e.Fragment,{children:[e.jsx(m,{}),e.jsx(l,{onClick:()=>n(),children:"Cerrar sesión"})]})]})]}):s.showLoginButton?e.jsxs(v,{onClick:()=>r(),variant:"opacity",size:"icon",className:"rounded-full",children:[e.jsx(re,{className:"h-6 w-6"}),e.jsx("span",{className:"sr-only",children:"Login"})]}):s.activateAutoLogin?e.jsx(ue,{}):s.showOrderComponentsInNavbar?void 0:e.jsx("div",{className:"w-9"})}function ze(){const t=g(),n=I(),{pathname:r}=A(),s=L(),o=f(),a=N();return e.jsxs("div",{id:"headerSticky",className:C("bg-unsafe-white border-b px-5 pb-2","flex items-center justify-end","overflow-hidden w-screen","sticky top-0 z-20"),style:{paddingTop:n.top||6},children:[e.jsx("div",{className:"flex-1 overflow-hidden flex items-center",children:e.jsxs(k,{onClick:()=>{r.startsWith("/checkout")?s(`/pedir?webview=${o}`):window.location.href=`https://justoapp.getjusto.com/pide?webview=${o}&target=${a}`},className:"flex items-center space-x-3 truncate",children:[e.jsx(W,{className:"w-10 -m-3"}),e.jsx("div",{className:"font-bold text-2xl truncate flex-1",children:t.name})]})}),e.jsx(b,{fallback:e.jsx($,{variant:"secondary",size:"icon",className:"rounded-full"}),children:e.jsx(he,{})})]})}function me(){window.location.href="justoapp://back"}function De(){const t=g(),n=I(),{pathname:r}=A(),s=L();return e.jsx("div",{id:"headerSticky",className:C("bg-unsafe-white border-b px-5 pb-2","flex items-center justify-end","overflow-hidden w-screen","sticky top-0 z-20"),style:{paddingTop:n.top||6},children:e.jsx("div",{className:"flex-1 overflow-hidden flex items-center",children:e.jsxs(k,{onClick:()=>{r.startsWith("/checkout")?s("/pedir"):me()},className:"flex items-center space-x-3 truncate",children:[e.jsx(W,{className:"w-10 -m-3"}),e.jsx("div",{className:"font-bold text-2xl truncate flex-1",children:t.name})]})})})}export{W as C,ze as E,De as J,ae as S,he as U,ee as a,ce as c,le as u};
